_N_E=(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[14],{4:function(e,t,r){r("j36g"),e.exports=r("4vwo")},"4vwo":function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/[channel]/archive/[...article]",function(){return r("6eFE")}])},"6eFE":function(e,t,r){"use strict";r.r(t);var n=r("vJKn"),a=r.n(n),i=r("cpVT"),o=r("xvhg"),u=r("rg98"),c=r("jT3O"),l=r("q1tI"),s=r.n(l),p=r("mOvS"),d=r.n(p),f=r("Vvt1"),v=r.n(f),w=r("LZ9u"),b=r("gI8X"),y=r("XrP9"),m=r("fPoB"),g=d()().publicRuntimeConfig;function h(e){var t=e.article,r=t.layout,n=t.isTnfCompatible,a=e.swanTestGroup,i="true"===g.ENABLE_FEATURE_ARTICLE_RENDER;if(a){if(i||n)return;throw new m.a}if("feature"===r||!n){if(!i)throw new m.a;console.warn("Attempting to render an article that may not be supported")}}var E=s.a.createElement;function O(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function j(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?O(Object(r),!0).forEach((function(t){Object(i.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):O(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _(){var e=Object(c.a)(["\n  query ArticleInitialPropsQuery($id: ID!, $preview: String) {\n    article(id: $id, preview: $preview) {\n      id\n      isTnfCompatible\n      layout\n      hasMeter\n      url\n    }\n  }\n"]);return _=function(){return e},e}var P=d()().publicRuntimeConfig,C=v()((function(){return Promise.all([r.e(0),r.e(4),r.e(20)]).then(r.bind(null,"YUmz"))}),{ssr:!0,loadableGenerated:{webpack:function(){return["YUmz"]},modules:["components/article/Article"]}}),T=v()((function(){return Promise.all([r.e(0),r.e(4),r.e(21)]).then(r.bind(null,"X6Fy"))}),{ssr:!0,loadableGenerated:{webpack:function(){return["X6Fy"]},modules:["components/article/goose/GooseArticle"]}}),x=function(e){var t=e.layout,r=e.queryParams,n=e.swanTestGroup||"feature"===t||(null===r||void 0===r?void 0:r.includes("duckling=swan"))&&"true"===P.ENABLE_FEATURE_ARTICLE_RENDER;return E(w.a,{analyticsCategory:"story page"},E(n?C:T,null))},k=Object(b.a)(_());x.getInitialProps=function(){var e=Object(u.a)(a.a.mark((function e(t){var r,n,i,u,c,l,s,p,d,f,v,w,b,g,E,O,_,P,C,T,x,A,R,H,X;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.urqlClient,i=t.query,u=t.req,c=t.res,l=i.article,s=Object(o.a)(l,4),s[0],s[1],s[2],p=s[3],d=new RegExp(/\/[a-z-]+\/archive\/\d{4}\/\d{2}\/[a-z\-\_\d]+\/\d+/i),null===u||void 0===u||!u.url){e.next=7;break}if(null===u||void 0===u||null===(f=u.url)||void 0===f?void 0:f.match(d)){e.next=7;break}throw new m.b;case 7:return v="string"===typeof i.preview?i.preview:null,e.next=10,n.query(k,{id:p,preview:v}).toPromise();case 10:if(w=e.sent,c&&(c.setHeader("Surrogate-Key","article-id-".concat(p)),i.preview&&c.setHeader("Cache-Control","private, no-store, max-age=0")),!c||null===(r=w.data)||void 0===r||!r.article){e.next=29;break}return E=[99],O=c.getHeader("Vary"),_=Array.isArray(O)?O:"".concat(O||"").split(",").map((function(e){return e.trim()})).filter(Boolean),E.forEach((function(e){_.push("X-Test-Bucket-".concat(e))})),c.setHeader("Vary",_.join(", ")),P=w.data.article,C=P.id.split(":")[1],T=(null===u||void 0===u||null===(b=u.url)||void 0===b?void 0:b.split(d)[1].slice(1))||"",x=T.split("&"),A=E.some((function(e){return"1"===(null===u||void 0===u?void 0:u.headers["x-test-bucket-".concat(e)])||x.includes("fastly_bucket=".concat(e))})),h(j(j({},w.data),{},{swanTestGroup:A})),i.preview||(c.setHeader("Cache-Control","s-maxage=180"),c.setHeader("Surrogate-Control","max-age=180, stale-while-revalidate=86400, stale-if-error=259200")),P.hasMeter&&(c.setHeader("X-Is-Metered","1"),c.setHeader("X-Meter-Content",C),R=new Date,H=Object(y.a)(R),c.setHeader("X-Meter-Expires",H.toUTCString())),X=P.url.split("theatlantic.com")[1],-1===(null===u||void 0===u||null===(g=u.url)||void 0===g?void 0:g.indexOf(X))&&(c.setHeader("Location","".concat(X).concat(T)),c.statusCode=302,c.end()),e.abrupt("return",{layout:P.layout,queryParams:T,swanTestGroup:A});case 29:return e.abrupt("return",{});case 30:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();t.default=Object(b.c)(x)}},[[4,1,2,0,3,5]]]);
//# sourceMappingURL=[...article]-4c79455de971c3f39875.js.map